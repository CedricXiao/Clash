port: 7890
socks-port: 7891
redir-port: 7892
allow-lan: true
bind-address: '*'
mode: rule
log-level: info
ipv6: false

external-controller: 127.0.0.1:9090
external-ui: "/usr/share/openclash/ui"

dns:
  enable: true
  listen: 0.0.0.0:7874
  enhanced-mode: redir-host     # 使用 redir-host，兼容更强
  ipv6: false

  default-nameserver:
    - 119.29.29.29
    - 114.114.114.114

  nameserver:
    - https://dns.alidns.com/dns-query
    - https://doh.pub/dns-query

  fallback:
    - https://dns.cloudflare.com/dns-query
    - https://1.12.12.12/dns-query
    - tls://dns.google

  fallback-filter:
    geoip: true
    geoip-code: CN
    ipcidr:
      - 240.0.0.0/4


rule-providers:
    秋风广告规则: { type: http, behavior: domain, url: 'https://raw.githubusercontent.com/TG-Twilight/AWAvenue-Ads-Rule/main//Filters/AWAvenue-Ads-Rule-Clash.yaml', interval: 86400, path: ./rule_providers/AWAvenue-Ads-Rule-Clash.yaml }
    ChinaMax: { type: http, behavior: classical, url: 'https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/refs/heads/master/rule/Clash/ChinaMax/ChinaMax_Classical_No_IPv6.yaml', interval: 86400, path: ./ChinaMax_Classical_No_IPv6.yaml }
rules:
    - 'RULE-SET,秋风广告规则,REJECT'
    - 'RULE-SET,ChinaMax,DIRECT'
    - 'DOMAIN,local.adguard.org,DIRECT'
    - 'DOMAIN-SUFFIX,local,DIRECT'
    - 'IP-CIDR,127.0.0.0/8,DIRECT'
    - 'IP-CIDR,172.16.0.0/12,DIRECT'
    - 'IP-CIDR,192.168.0.0/16,DIRECT'
    - 'IP-CIDR,10.0.0.0/8,DIRECT'
    - 'IP-CIDR,17.0.0.0/8,DIRECT'
    - 'IP-CIDR,100.64.0.0/10,DIRECT'
    - 'IP-CIDR,224.0.0.0/4,DIRECT'
    - 'IP-CIDR,203.0.113.0/24,DIRECT'
    - 'IP-CIDR,192.0.2.0/24,DIRECT'
    - 'IP-CIDR6,fe80::/10,DIRECT'
    - 'GEOIP,CN,DIRECT'
    - 'GEOIP,LAN,DIRECT'
    - 'MATCH,PROXY'

